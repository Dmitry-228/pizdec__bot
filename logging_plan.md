# План улучшения системы логирования

## Цели
1. Создать централизованную систему логирования
2. Разделить логи по типам (БД, кнопки, генерации, API, оплаты)
3. Настроить ротацию файлов
4. Исключить логирование ошибок при блокировке бота пользователем
5. Создать тесты для проверки системы

## Этапы выполнения

### Этап 1: Создание logger.py
- [x] Создать файл `logger.py` с конфигурацией
- [x] Настроить разные логгеры для разных типов операций
- [x] Настроить ротацию файлов (раз в неделю для bot.log)
- [x] Создать папку `logs/` с подпапками

### Этап 2: Настройка логгеров
- [x] Основной логгер (bot.log)
- [x] Логгер для БД (logs/database.log)
- [x] Логгер для кнопок (logs/keyboards.log)
- [x] Логгер для генераций (logs/generation.log)
- [x] Логгер для API (logs/api.log)
- [x] Логгер для оплат (logs/payments.log)
- [x] Логгер для ошибок (logs/errors.log)

### Этап 3: Обновление существующих файлов
- [x] Заменить print на logger в config.py, onboarding_config.py, generation_config.py, cfg_ai.py
- [x] Заменить print на logger в excel_users.py
- [x] Добавить логирование в style.py и states.py (если нужно)
- [x] Обновить импорты logger во всех файлах

### Этап 4: Исключения для блокировок
- [x] Найти места где отправляются уведомления админам об ошибках
- [x] Добавить проверку на блокировку бота пользователем
- [x] Исключить логирование таких ошибок

### Этап 5: Тестирование
- [x] Создать тесты для проверки логирования
- [x] Проверить ротацию файлов
- [x] Проверить исключения для блокировок
- [x] Проверить разделение логов по типам

## Структура логов
```
logs/
├── bot.log (основной лог)
├── database.log (операции с БД)
├── keyboards.log (создание кнопок)
├── generation.log (генерации изображений/видео)
├── api.log (внешние API вызовы)
├── payments.log (операции с оплатами)
└── errors.log (критические ошибки)
```

## Конфигурация ротации
- bot.log: ротация раз в неделю, максимум 4 файла
- Остальные логи: ротация раз в месяц, максимум 12 файлов
- Размер файла: максимум 10MB

## Исключения для логирования
- Ошибки отправки сообщений заблокированным пользователям
- Ошибки при попытке отправить уведомление админу о блокировке
- Повторяющиеся ошибки API (с ограничением частоты)
